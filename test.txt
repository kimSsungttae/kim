#include <DHT.h>
#include <Phpoc.h>
#include <ThingSpeak.h>

#define DHTPIN 2
#define DHTTYPE DHT11
DHT dht(DHTPIN, DHTTYPE);
PhpocClient client; 

#define WriteAPI "1MGCQMNSPD3H6BJQ"
#define ReadAPI "QHKSZXRF6M9B6QRC"
long ChannelNumber = 856970;


void setup() {

pinMode(5, OUTPUT);
pinMode(7, OUTPUT);
Serial.begin(9600);
while(!Serial);
Phpoc.begin(PF_LOG_SPI | PF_LOG_NET);
Serial.println(Phpoc.localIP());
ThingSpeak.begin(client);
dht.begin();
}

void loop() {
int t = dht.readTemperature();
int h = dht.readHumidity();

ThingSpeak.setField(1, t);
ThingSpeak.setField(2, h);
ThingSpeak.writeFields(ChannelNumber, WriteAPI);
long get_data = ThingSpeak.readLongField(ChannelNumber, 2, ReadAPI); 
if(get_data > 20){
  digitalWrite(5, HIGH);
  digitalWrite(7, LOW);
  delay(3000);
  digitalWrite(5, LOW);
  digitalWrite(7, LOW);
}
}